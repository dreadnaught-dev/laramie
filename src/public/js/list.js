"use strict";var handlebarsTemplates=[],filterIndex=1;function addFilter(e){(e=e||{}).filterIndex=filterIndex,filterIndex+=1;var t=handlebarsTemplates["list-filter"],e=$(t(e));return $("#filters").append(e),$("#main-list-table").trigger("reflow"),e}function updateBulkActionState(){var e=0<$("#main-list-table .js-item-id:checked").length;$("#bulk-action-operation").attr("disabled",!e)}function loadHandlebarsTemplates(e){$('script[type="text/x-handlebars-template"]').each(function(e,t){t=$(t);handlebarsTemplates[t.attr("id")]=Handlebars.compile(t.html())})}function loadFilters(){if(0!=$("#filter-holder").length){0<globals.filters.length&&$("#filter-holder").show();for(var e=0;e<globals.filters.length;e++){var t=globals.filters[e],l=addFilter();l.find('[name$="field"]').val(t.field),l.find('[name$="operation"]').val(t.operation),l.find('[name$="value"]').val(t.value)}}}$(document).ready(function(){loadHandlebarsTemplates(),loadFilters(),window.onblur=function(){$("#bulk-action-operation").val("")},$(".js-toggle-page-settings").on("click",function(){$("#page-settings").toggleClass("is-active"),$.event.trigger("modal-change")}),dragula([$("#selectable-fields")[0]]),$(".js-toggle-save-report").on("click",function(){$("#save-report-modal").toggleClass("is-active"),$.event.trigger("modal-change")}),$(".js-clear-search").on("click",function(e){$("#quick-search").val(""),$(e.target).closest("form").submit()}),$("#save-report-form").submit(function(e){var t=$(e.target);if(!(t.find("#modal-report-name").val()||"").trim())return alert("You must provide a report name."),!1;$("#is-filtering").val("");e=$("#list-form");return e.attr("method","post").attr("action",e.data("saveReportAction")).append($('<div style="display:none"></div>').append(t.find(":input").clone())).submit(),!1}),$("#save-list-prefs-form").submit(function(e){$("#is-filtering").val("");var t=$("#list-form");return t.attr("method","post").attr("action",t.data("saveListPrefsAction")).append($('<div style="display:none"></div>').append($(e.target).find(":input").clone())).submit(),!1}),$(document).on("keyup keydown",function(e){globals.isShiftDetected=e.shiftKey}),$(".js-select-all, .js-item-id").click(function(e){var t=$(e.target),e=t.is(":checked");if(t.is(".js-select-all"))$("#main-list-table .js-item-id:not([disabled])").prop("checked",e).trigger("change");else if(e){if(e){var l=t.closest("tr");if(globals.lastRowSelected&&globals.isShiftDetected)for(var i=$("#main-list-table tbody tr"),a=i.index(l),s=i.index(globals.lastRowSelected),r=i.index(l);r!=i.index(globals.lastRowSelected);r+=a<=s?1:-1)i.eq(r).find(".js-item-id").prop("checked",!0);globals.lastRowSelected=l}}else $(".js-select-all").prop("checked",!1);l=$(".js-select-all").is(":checked")||$(".js-item-id").length==$(".js-item-id:checked").length;l&&"1"==$("#bulk-action-helper").data("hasAdditionalPages")?($(".js-select-all").prop("checked",!0),$("#bulk-action-helper").show()):l?$("#bulk-action-all-selected").val("1"):($("#bulk-action-helper").hide().removeClass("all-selected"),$("#bulk-action-all-selected").val("")),$("#main-list-table").trigger("reflow"),updateBulkActionState()}),$("#list-form").submit(function(e){"1"==$("#is-filtering").val()&&$(e.target).find(".post-only").remove()}),$(".js-delete").click(function(e){var t;confirm("Delete this item?")&&(e=$(e.target),t=e.closest("tr"),$.post(e.data("action"),{_method:"DELETE"},function(e){e.success?(t.remove(),["viewing-end","viewing-total"].forEach(function(e){$("#"+e).text((Number($("#"+e).text())||1)-1)})):alert(e.message)}))}),$(".js-bulk-select-all").click(function(){$("#bulk-action-helper").addClass("all-selected"),$("#bulk-action-all-selected").val("1")}),$(".js-clear-bulk-selection").click(function(){$("#bulk-action-helper").removeClass("all-selected"),$("#bulk-action-all-selected").val(""),$(".js-select-all").trigger("click")}),$("#bulk-action-operation").change(function(e){e=$(e.target).val().toLowerCase().replace(/\([^\)]+\)/,"").trim();return e&&(confirm("Are you sure you want to "+e+" these items?")?($("#is-filtering").val(""),(e=$("#list-form")).attr("method","post").attr("action",e.data("bulkAction")).submit()):$("#bulk-action-operation").val("")),!1}),$(".js-advanced-search").click(function(){$("#filter-holder").toggle(),$("#filter-holder").is(":visible")&&0==$(".filter-set").length&&addFilter()}),$("#filter-holder").on("click.add-filter",".js-add-filter",addFilter),$("#filters").on("click.remove-filter",".js-remove-filter",function(e){$(e.target).closest(".filter-set").remove(),$("#main-list-table").trigger("reflow"),0==$("#filters > .filter-set").length&&$("#filter-holder").hide(),0<globals.filters.length&&0==$("#filters > .filter-set").length&&$("#list-form").submit()}),$(".js-set-default-report").click(function(e){confirm("Use this report as default view for this page?")&&($.post($(e.target).data("action")),$("#page-settings").removeClass("is-active"),$.event.trigger("modal-change"))}),$(".js-delete-report").click(function(e){e=$(e.target);confirm("Delete this saved report?")&&($.post(e.data("action")),e.closest(".field").remove(),$("#page-settings").removeClass("is-active"),$.event.trigger("modal-change"))}),$("#filters").on("click.remove-filter",".js-remove-filter",function(e){$(e.target).closest(".filter-set").remove(),$("#main-list-table").trigger("reflow"),0<globals.filters.length&&0==$("#filters > .filter-set").length&&$("#list-form").submit()}),$(".js-meta").on("click",function(e){e=$(e.target);$("#meta-modal-wrapper").toggleClass("is-active"),$.event.trigger("modal-change"),$("#meta-modal-wrapper").hasClass("is-active")&&(e=e.closest(".has-invisibles").find(".js-item-id:checkbox").val(),loadMeta(e))}),$(document).on("meta-change",function(e,t){$("#row-"+t.id+" .tag-count").text(t.meta.tags.length),$("#row-"+t.id+" .comment-count").text(t.meta.comments.length)})});
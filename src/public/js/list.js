var handlebarsTemplates=[],filterIndex=1;function addFilter(e){(e=e||{}).filterIndex=filterIndex,filterIndex+=1;var t=handlebarsTemplates["list-filter"],l=$(t(e));return $("#filters").append(l),$("#main-list-table").trigger("reflow"),l}function updateBulkActionState(){var e=0<$("#main-list-table .js-item-id:checked").length;$("#bulk-action-operation").attr("disabled",!e)}function loadHandlebarsTemplates(e){$('script[type="text/x-handlebars-template"]').each(function(){var e=$(this);handlebarsTemplates[e.attr("id")]=Handlebars.compile(e.html())})}function loadFilters(){0<globals.filters.length&&$("#filter-holder").show();for(var e=0;e<globals.filters.length;e++){var t=globals.filters[e],l=addFilter();l.find('[name$="field"]').val(t.field),l.find('[name$="operation"]').val(t.operation),l.find('[name$="value"]').val(t.value)}}$(document).ready(function(){loadHandlebarsTemplates(),loadFilters(),window.onblur=function(){$("#bulk-action-operation").val("")},$(".js-toggle-page-settings").on("click",function(){$("#page-settings").toggleClass("is-active"),$.event.trigger("modal-change")}),dragula([$("#selectable-fields")[0]]),$(".js-toggle-save-report").on("click",function(){$("#save-report-modal").toggleClass("is-active"),$.event.trigger("modal-change")}),$(".js-clear-search").on("click",function(){$("#quick-search").val(""),$(this).closest("form").submit()}),$("#save-report-form").submit(function(){if(!($(this).find("#modal-report-name").val()||"").trim())return alert("You must provide a report name."),!1;$("#is-filtering").val("");var e=$("#list-form");return e.attr("method","post").attr("action",e.data("saveReportAction")).append($('<div style="display:none"></div>').append($(this).find(":input").clone())).submit(),!1}),$("#save-list-prefs-form").submit(function(){$("#is-filtering").val("");var e=$("#list-form");return e.attr("method","post").attr("action",e.data("saveListPrefsAction")).append($('<div style="display:none"></div>').append($(this).find(":input").clone())).submit(),!1}),$(".js-select-all, .js-item-id").click(function(){var e=$(this).is(":checked");$(this).is(".js-select-all")?$("#main-list-table .js-item-id").prop("checked",e):e||$(".js-select-all").prop("checked",!1),($(".js-select-all").is(":checked")||$(".js-item-id").length==$(".js-item-id:checked").length)&&"1"==$("#bulk-action-helper").data("hasAdditionalPages")?($(".js-select-all").prop("checked",!0),$("#bulk-action-helper").show()):($("#bulk-action-helper").hide().removeClass("all-selected"),$("#bulk-action-all-selected").val("")),$("#main-list-table").trigger("reflow"),updateBulkActionState()}),$("#list-form").submit(function(){"1"==$("#is-filtering").val()&&$(this).find(".post-only").remove()}),$(".js-delete").click(function(){confirm("Delete this item?")&&($row=$(this).closest("tr"),$.post($(this).data("action"),{_method:"DELETE"},function(e){e.success?$row.remove():alert(e.message)}))}),$(".js-bulk-select-all").click(function(){$("#bulk-action-helper").addClass("all-selected"),$("#bulk-action-all-selected").val("1")}),$(".js-clear-bulk-selection").click(function(){$("#bulk-action-helper").removeClass("all-selected"),$("#bulk-action-all-selected").val(""),$(".js-select-all").trigger("click")}),$("#bulk-action-operation").change(function(){var e=$(this).val().toLowerCase().replace(/\([^\)]+\)/,"").trim();if(e)if(confirm("Are you sure you want to "+e+" these items?")){$("#is-filtering").val("");var t=$("#list-form");t.attr("method","post").attr("action",t.data("bulkAction")).submit(),$(this).closest("form").submit()}else $("#bulk-action-operation").val("");return!1}),$(".js-advanced-search").click(function(){$("#filter-holder").toggle(),$("#filter-holder").is(":visible")&&0==$(".filter-set").length&&addFilter()}),$("#filter-holder").on("click.add-filter",".js-add-filter",addFilter),$("#filters").on("click.remove-filter",".js-remove-filter",function(){$(this).closest(".filter-set").remove(),$("#main-list-table").trigger("reflow"),0==$("#filters > .filter-set").length&&$("#filter-holder").hide(),0<globals.filters.length&&0==$("#filters > .filter-set").length&&$("#list-form").submit()}),$(".js-set-default-report").click(function(){confirm("Use this report as default view for this page?")&&($.post($(this).data("action")),$("#page-settings").removeClass("is-active"),$.event.trigger("modal-change"))}),$(".js-delete-report").click(function(){confirm("Delete this saved report?")&&($.post($(this).data("action")),$(this).closest(".field").remove(),$("#page-settings").removeClass("is-active"),$.event.trigger("modal-change"))}),$("#filters").on("click.remove-filter",".js-remove-filter",function(){$(this).closest(".filter-set").remove(),$("#main-list-table").trigger("reflow"),0<globals.filters.length&&0==$("#filters > .filter-set").length&&$("#list-form").submit()}),$(".js-meta").on("click",function(){if($("#meta-modal-wrapper").toggleClass("is-active"),$.event.trigger("modal-change"),$("#meta-modal-wrapper").hasClass("is-active")){var e=$(this).closest(".has-invisibles").find(".js-item-id:checkbox").val();loadMeta(e)}}),$(document).on("meta-change",function(e,t){$("#row-"+t.id+" .tag-count").text(t.meta.tags.length),$("#row-"+t.id+" .comment-count").text(t.meta.comments.length)})});